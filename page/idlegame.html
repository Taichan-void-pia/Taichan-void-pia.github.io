<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ğŸ’° æ”¾ç½®ãƒãƒãƒ¼ã‚²ãƒ¼ãƒ  Rebirth Edition</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at center, #101010 0%, #000 100%);
      color: #fff;
      text-align: center;
    }
    h1 {
      margin-top: 30px;
      color: #00e676;
      text-shadow: 0 0 10px #00e676;
    }
    .stats {
      margin: 20px auto;
      background: rgba(255,255,255,0.05);
      padding: 15px 30px;
      border-radius: 12px;
      display: inline-block;
    }
    .money { font-size: 1.8em; color: #00e676; font-weight: bold; }
    .upgrade-container {
      display: flex; flex-wrap: wrap;
      justify-content: center; gap: 20px; margin-top: 30px;
    }
    .upgrade-card {
      background: rgba(255,255,255,0.08);
      border-radius: 12px; width: 240px; padding: 15px;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
      transition: 0.3s;
    }
    .upgrade-card:hover { transform: translateY(-4px); box-shadow: 0 0 20px rgba(0,255,100,0.4); }
    button {
      margin-top: 10px;
      background: linear-gradient(90deg, #00e676, #00bfa5);
      border: none; border-radius: 8px; padding: 8px 15px;
      color: white; font-size: 1em; cursor: pointer; width: 100%;
    }
    button:hover { transform: scale(1.05); }
    .reset-btn {
      margin-top: 40px; background: #f44336;
    }
    .prestige {
      margin-top: 40px;
      background: linear-gradient(90deg, #ffca28, #f57f17);
      border: none; border-radius: 10px; padding: 15px 30px;
      color: #000; font-size: 1.2em; cursor: pointer;
    }
    .prestige:disabled { background: #555; color: #ccc; cursor: not-allowed; }
    .prestige-upgrades {
      margin-top: 40px;
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 20px;
      width: 90%;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ’° æ”¾ç½®ãƒãƒãƒ¼ã‚²ãƒ¼ãƒ  Rebirth Edition</h1>
  <div class="stats">
    <div>æ‰€æŒé‡‘ï¼š<span class="money" id="money">0</span></div>
    <div>1ç§’ã‚ãŸã‚Šã®åå…¥ï¼š<span id="rate">1</span></div>
    <div>è»¢ç”Ÿãƒã‚¤ãƒ³ãƒˆï¼š<span id="prestigePoints">0</span></div>
  </div>

  <div class="upgrade-container" id="upgradeList"></div>

  <button id="prestigeBtn" class="prestige" disabled onclick="doPrestige()">âœ¨ è»¢ç”Ÿã™ã‚‹</button>
  <div class="prestige-upgrades">
    <h3>ğŸŒŸ è»¢ç”Ÿã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h3>
    <div>è»¢ç”Ÿå€ç‡ã‚¢ãƒƒãƒ—ï¼š<span id="prestigeMultLevel">0</span> Lv ï¼ˆã‚³ã‚¹ãƒˆ1ï¼‰<button onclick="buyPrestigeUpgrade('mult')">è³¼å…¥</button></div>
    <div>å¼·åŒ–ã‚³ã‚¹ãƒˆåŠ¹ç‡åŒ–ï¼š<span id="prestigeEffLevel">0</span> Lv ï¼ˆã‚³ã‚¹ãƒˆ2ï¼‰<button onclick="buyPrestigeUpgrade('eff')">è³¼å…¥</button></div>
  </div>

  <button class="reset-btn" onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

  <script>
    let money = 0;
    let incomePerSecond = 1;
    let efficiency = 1;
    let prestigePoints = 0;
    let prestigeMultiplier = 1;
    let prestigeEffReduction = 1;
    let upgrades = [
      { name: "åå…¥ã‚¢ãƒƒãƒ—", desc: "åŸºæœ¬åå…¥ã‚’ä¸Šã’ã¾ã™", baseCost: 10, level: 0, effect: () => incomePerSecond *= 1.5 },
      { name: "åŠ¹ç‡ã‚¢ãƒƒãƒ—", desc: "åå…¥å€ç‡ã‚’ä¸Šã’ã¾ã™", baseCost: 25, level: 0, effect: () => efficiency *= 1.2 },
      { name: "è‡ªå‹•è²©å£²æ©Ÿ", desc: "åå…¥ã‚’å¤§ããã‚¢ãƒƒãƒ—", baseCost: 100, level: 0, effect: () => incomePerSecond *= 2 },
      { name: "éŠ€è¡ŒæŠ•è³‡", desc: "é•·æœŸçš„ãªåå…¥åŠ¹ç‡UP", baseCost: 500, level: 0, effect: () => efficiency *= 1.5 },
      { name: "AIç”Ÿæˆå·¥å ´", desc: "è¶…é«˜é€Ÿåå…¥ã‚·ã‚¹ãƒ†ãƒ ", baseCost: 2000, level: 0, effect: () => incomePerSecond *= 3 },
    ];

    function getUpgradeCost(u) {
      return Math.floor(u.baseCost * Math.pow(1.7, u.level) / prestigeEffReduction);
    }

    function updateDisplay() {
      document.getElementById("money").textContent = Math.floor(money);
      document.getElementById("rate").textContent = (incomePerSecond * efficiency * prestigeMultiplier).toFixed(2);
      document.getElementById("prestigePoints").textContent = prestigePoints;
      document.getElementById("prestigeMultLevel").textContent = prestigeMultiplier - 1;
      document.getElementById("prestigeEffLevel").textContent = (prestigeEffReduction - 1).toFixed(1);

      document.getElementById("upgradeList").innerHTML = "";
      upgrades.forEach((u, i) => {
        const div = document.createElement("div");
        div.className = "upgrade-card";
        div.innerHTML = `
          <h3>${u.name}</h3>
          <p>${u.desc}</p>
          <p>Lv ${u.level}</p>
          <button onclick="buyUpgrade(${i})">è³¼å…¥ï¼ˆ${getUpgradeCost(u)}ï¼‰</button>
        `;
        document.getElementById("upgradeList").appendChild(div);
      });

      document.getElementById("prestigeBtn").disabled = money < 100000;
    }

    function buyUpgrade(i) {
      const u = upgrades[i];
      const cost = getUpgradeCost(u);
      if (money >= cost) {
        money -= cost;
        u.level++;
        u.effect();
        updateDisplay();
        saveGame();
      }
    }

    function buyPrestigeUpgrade(type) {
      if (type === "mult" && prestigePoints >= 1) {
        prestigePoints -= 1;
        prestigeMultiplier += 1;
      } else if (type === "eff" && prestigePoints >= 2) {
        prestigePoints -= 2;
        prestigeEffReduction += 0.2;
      }
      updateDisplay();
      saveGame();
    }

    function doPrestige() {
      if (money < 100000) return;
      const earned = Math.floor(Math.log10(money) - 4);
      prestigePoints += earned;
      money = 0;
      incomePerSecond = 1;
      efficiency = 1;
      upgrades.forEach(u => u.level = 0);
      updateDisplay();
      saveGame();
    }

    function resetGame() {
      if (confirm("å…¨ã¦ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
        localStorage.removeItem("idleRebirthSave");
        location.reload();
      }
    }

    function saveGame() {
      const save = {
        money, incomePerSecond, efficiency,
        prestigePoints, prestigeMultiplier, prestigeEffReduction, upgrades
      };
      localStorage.setItem("idleRebirthSave", JSON.stringify(save));
    }

    function loadGame() {
      const data = JSON.parse(localStorage.getItem("idleRebirthSave") || "{}");
      Object.assign(window, data);
      if (!upgrades) upgrades = [];
    }

    loadGame();

    // --- ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— ---
    let last = Date.now();
    function loop() {
      const now = Date.now();
      const delta = (now - last) / 1000;
      last = now;
      money += incomePerSecond * efficiency * prestigeMultiplier * delta;
      updateDisplay();
      requestAnimationFrame(loop);
    }

    updateDisplay();
    loop();
  </script>
</body>
</html>
