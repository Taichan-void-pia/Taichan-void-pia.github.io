<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ’° æ”¾ç½®ãƒãƒãƒ¼ã‚²ãƒ¼ãƒ ï¼ˆãƒ¬ãƒ™ãƒ«ä¾å­˜ä¹—æ•°å¢—åŠ ï¼‰</title>
<style>
  body { font-family:"Segoe UI",sans-serif; background:#111; color:#fff; text-align:center; margin:0; padding:20px; }
  h1 { color:#00e676; text-shadow:0 0 8px #00e676; }
  .stats { margin:20px auto; padding:10px 20px; background:rgba(255,255,255,0.05); border-radius:12px; width:400px; }
  .money { font-size:1.8em; color:#00e676; font-weight:bold; }
  .formula { font-size:0.9em; color:#ccc; margin-top:5px; }
  .upgrade { background:rgba(255,255,255,0.07); border-radius:10px; padding:12px; margin:10px auto; width:90%; max-width:500px; box-shadow:0 0 6px rgba(0,0,0,0.4); }
  .meter { background:rgba(255,255,255,0.1); border-radius:10px; height:18px; overflow:hidden; margin:8px 0; }
  .fill { height:100%; background:linear-gradient(90deg,#00e676,#00bfa5); width:0%; transition:width 0.1s linear; }
  button { background:linear-gradient(90deg,#00e676,#00bfa5); border:none; border-radius:6px; color:black; font-weight:bold; padding:6px 12px; cursor:pointer; }
  button:hover { transform:scale(1.03); }
</style>
</head>
<body>
  <h1>ğŸ’° æ”¾ç½®ãƒãƒãƒ¼ã‚²ãƒ¼ãƒ </h1>
  <div class="stats">
    <div>æ‰€æŒé‡‘ï¼š<span class="money" id="money">0</span></div>
    <div>1ç§’ã‚ãŸã‚Šã®åå…¥ï¼š<span id="rate">0</span></div>
    <div class="formula" id="formula">(è¨ˆç®—å¼)</div>
  </div>

  <div id="upgradeContainer"></div>

<script>
let money = 0;
let baseIncome = 1;

// ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å®šç¾©
let upgrades = [
  { name:"åå…¥ã‚¢ãƒƒãƒ—", rate:1, mult:0, speedMult:1.5, baseCost:10, level:0, progress:0 },
  { name:"åŠ¹ç‡ã‚¢ãƒƒãƒ—", rate:0.8, mult:0, speedMult:1.4, baseCost:30, level:0, progress:0 },
  { name:"è‡ªå‹•è²©å£²æ©Ÿ", rate:0.6, mult:0, speedMult:1.3, baseCost:100, level:0, progress:0 },
  { name:"éŠ€è¡ŒæŠ•è³‡", rate:0.4, mult:0, speedMult:1.25, baseCost:500, level:0, progress:0 },
  { name:"AIç”Ÿæˆå·¥å ´", rate:0.2, mult:0, speedMult:1.2, baseCost:2000, level:0, progress:0 },
];

function getUpgradeCost(u){ return Math.floor(u.baseCost * Math.pow(2.2, u.level)); }

function formatNum(n){
  if (!isFinite(n)) return "Infinity";
  if (n >= 1e9) return n.toExponential(2);
  return Math.floor(n).toLocaleString();
}

function updateDisplay() {
  document.getElementById("money").textContent = formatNum(money);

  // ç·ä¹—æ•°ï¼ˆæ›ã‘ç®—ï¼‰
  const totalMult = upgrades.reduce((acc, u) => acc * (1 + u.mult), 1);
  const incomePerSecond = baseIncome * totalMult;

  document.getElementById("rate").textContent = incomePerSecond.toFixed(2);
  document.getElementById("formula").textContent =
    `åå…¥ = ${baseIncome} Ã— ` + upgrades.map(u=>`(1+${u.mult.toFixed(3)})`).join(" Ã— ") + ` = ${incomePerSecond.toFixed(2)}`;

  // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä¸€è¦§æç”»
  const container = document.getElementById("upgradeContainer");
  container.innerHTML = "";
  upgrades.forEach((u,i)=>{
    const div = document.createElement("div");
    div.className = "upgrade";
    const cost = getUpgradeCost(u);
    div.innerHTML = `
      <h3>${u.name} (Lv ${u.level})</h3>
      <div>ç¾åœ¨ã®ä¹—æ•°åŠ ç®—å€¤åˆè¨ˆ: +${u.mult.toFixed(3)}</div>
      <div>ãƒ¡ãƒ¼ã‚¿ãƒ¼å……å¡«é€Ÿåº¦: ${u.rate.toFixed(2)}%/s</div>
      <div class="meter"><div class="fill" id="fill${i}" style="width:${Math.min(u.progress,100)}%;"></div></div>
      <button onclick="buyUpgrade(${i})">è³¼å…¥ (${cost.toLocaleString()}å††)</button>
    `;
    container.appendChild(div);
  });
}

function buyUpgrade(i){
  const u = upgrades[i];
  const cost = getUpgradeCost(u);
  if(money >= cost){
    money -= cost;
    u.level++;
    // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ãƒ¡ãƒ¼ã‚¿ãƒ¼é€Ÿåº¦ã‚’å¢—åŠ ï¼ˆæ§ãˆã‚ã«ï¼‰
    u.rate *= u.speedMult;
    updateDisplay();
  } else {
    alert("ãŠé‡‘ãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
  }
}

// ä¹—æ•°å¢—åˆ†ã‚’ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦æ±ºã‚ã‚‹é–¢æ•°
function getMultiplierIncrement(u){
  // åŸºæœ¬å¢—åˆ† 0.01 ã«ãƒ¬ãƒ™ãƒ«ä¾å­˜ã§å¢—ã‚„ã™ (level 0 -> 0.01, level1 -> 0.02, ...)
  return 0.01 * (1 + u.level);
}

let last = Date.now();
function loop(){
  const now = Date.now();
  const delta = (now - last)/1000;
  last = now;

  // å„ãƒ¡ãƒ¼ã‚¿ãƒ¼æ›´æ–°ï¼ˆrate ã®å˜ä½ã¯ "%/s" ã¨ã—ã¦100ã§æº€ã‚¿ãƒ³ï¼‰
  upgrades.forEach(u=>{
    u.progress += u.rate * delta * 100; // rateã‚’ "1/s" -> progress% å˜ä½ã«æ›ç®— (rate * delta *100)
    // ã‚‚ã—100%ä»¥ä¸Šæºœã¾ã£ã¦ã„ãŸã‚‰è¤‡æ•°å›åˆ†å‡¦ç†
    while(u.progress >= 100){
      u.progress -= 100;
      const inc = getMultiplierIncrement(u);
      u.mult += inc;
    }
  });

  // åå…¥åŠ ç®—ï¼ˆæ›ã‘ç®—ã®åˆè¨ˆï¼‰
  const totalMult = upgrades.reduce((acc, u) => acc * (1 + u.mult), 1);
  money += baseIncome * totalMult * delta;

  // ãƒ¡ãƒ¼ã‚¿ãƒ¼UIæ›´æ–°ï¼ˆè¤‡æ•°ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¯¾è±¡ãŒã‚ã‚‹ã®ã§å¾Œã§ updateDisplay ã§ã‚‚åæ˜ ï¼‰
  upgrades.forEach((u,i)=>{
    const fill = document.getElementById("fill"+i);
    if(fill) fill.style.width = Math.min(u.progress,100) + "%";
  });

  updateDisplay();
  requestAnimationFrame(loop);
}

// åˆæœŸæç”»ã¨ãƒ«ãƒ¼ãƒ—é–‹å§‹
updateDisplay();
loop();
</script>
</body>
</html>
