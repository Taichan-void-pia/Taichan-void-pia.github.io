<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ’° æ”¾ç½®ãƒãƒãƒ¼ã‚²ãƒ¼ãƒ  âˆRebirth Edition (Debug)</title>
<style>
  body { margin:0; font-family:'Segoe UI',sans-serif; background:radial-gradient(circle,#0b0b0b,#000); color:#fff; text-align:center; }
  h1 { margin-top:30px; color:#00e676; text-shadow:0 0 10px #00e676; }
  .stats { margin:20px auto; background:rgba(255,255,255,0.05); padding:15px 30px; border-radius:12px; display:inline-block; }
  .money { font-size:1.8em; color:#00e676; font-weight:bold; }
  .meter { margin:10px auto; width:300px; height:20px; background:rgba(255,255,255,0.1); border-radius:10px; overflow:hidden; }
  .fill { height:100%; width:0%; background:linear-gradient(90deg,#00e676,#00bfa5); border-radius:10px; transition:width 0.2s linear; }
  .upgrade-container { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin-top:30px; }
  .upgrade-card { background:rgba(255,255,255,0.08); border-radius:12px; width:240px; padding:15px; box-shadow:0 0 8px rgba(0,0,0,0.4); transition:0.3s; }
  .upgrade-card:hover { transform:translateY(-4px); box-shadow:0 0 20px rgba(0,255,100,0.4); }
  button { margin-top:10px; background:linear-gradient(90deg,#00e676,#00bfa5); border:none; border-radius:8px; padding:8px 15px; color:white; font-size:1em; cursor:pointer; width:100%; }
  button:hover { transform:scale(1.03); }
  .prestige { margin-top:40px; background:linear-gradient(90deg,#ffca28,#f57f17); border:none; border-radius:10px; padding:15px 30px; color:#000; font-size:1.2em; cursor:pointer; }
  .prestige:disabled { background:#555; color:#ccc; cursor:not-allowed; }
  .prestige-upgrades { margin-top:40px; background:rgba(255,255,255,0.05); border-radius:16px; padding:20px; width:90%; margin-left:auto; margin-right:auto; }
  .reset-btn { margin-top:40px; background:#f44336; border:none; border-radius:8px; padding:10px 20px; color:white; font-size:1em; cursor:pointer; }
  /* DEBUG panel */
  #debugPanel { margin:20px auto; width:90%; max-width:720px; background:rgba(255,255,255,0.03); border-radius:10px; padding:12px; text-align:left; box-shadow:0 0 10px rgba(255,255,255,0.02); }
  #debugPanel input[type="text"] { width:200px; padding:6px; border-radius:6px; border:1px solid rgba(255,255,255,0.08); background:rgba(0,0,0,0.4); color:#fff; }
  #debugPanel .small { font-size:0.9em; color:#ccc; }
</style>
</head>
<body>
  <h1>ğŸ’° æ”¾ç½®ãƒãƒãƒ¼ã‚²ãƒ¼ãƒ  âˆRebirth Edition (Debug)</h1>
  <div class="stats">
    <div>æ‰€æŒé‡‘ï¼š<span class="money" id="money">0</span></div>
    <div>1ç§’ã‚ãŸã‚Šã®åå…¥ï¼š<span id="rate">1</span></div>
    <div class="meter"><div class="fill" id="fill"></div></div>
    <div>è»¢ç”Ÿãƒã‚¤ãƒ³ãƒˆï¼š<span id="prestigePoints">0</span></div>
  </div>

  <div class="upgrade-container" id="upgradeList"></div>
  <button id="prestigeBtn" class="prestige" disabled onclick="doPrestige()">âœ¨ è»¢ç”Ÿã™ã‚‹</button>

  <div class="prestige-upgrades">
    <h3>ğŸŒŸ è»¢ç”Ÿã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h3>
    <div>è»¢ç”Ÿå€ç‡ã‚¢ãƒƒãƒ—ï¼š<span id="prestigeMultLevel">0</span> Lvï¼ˆã‚³ã‚¹ãƒˆ1ï¼‰<button onclick="buyPrestigeUpgrade('mult')">è³¼å…¥</button></div>
    <div>å¼·åŒ–ã‚³ã‚¹ãƒˆåŠ¹ç‡åŒ–ï¼š<span id="prestigeEffLevel">0</span> Lvï¼ˆã‚³ã‚¹ãƒˆ2ï¼‰<button onclick="buyPrestigeUpgrade('eff')">è³¼å…¥</button></div>
  </div>

  <button class="reset-btn" onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>

  <!-- --- DEBUG PANEL --- -->
  <div id="debugPanel">
    <div class="small">ãƒ‡ãƒãƒƒã‚°æ“ä½œï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰</div>
    <div style="margin-top:8px;">
      <label>æ‰€æŒé‡‘ã‚’ã‚»ãƒƒãƒˆï¼š<input id="dbgMoney" type="text" placeholder="ä¾‹: 100000 or 1.8e308"></label>
      <button onclick="dbgSetMoney()">ã‚»ãƒƒãƒˆ</button>
    </div>
    <div style="margin-top:8px;">
      <label>è»¢ç”Ÿãƒã‚¤ãƒ³ãƒˆã‚’ã‚»ãƒƒãƒˆï¼š<input id="dbgPrestige" type="text" placeholder="ä¾‹: 1"></label>
      <button onclick="dbgSetPrestige()">ã‚»ãƒƒãƒˆ</button>
    </div>
    <div style="margin-top:8px;">
      <label><input id="dbgBypassConfirm" type="checkbox"> ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ç„¡åŠ¹ï¼ˆå±é™ºï¼‰</label>
    </div>
    <div style="margin-top:8px;">
      <button style="background:#ff1744;" onclick="dbgForcePrestige()">å¼·åˆ¶è»¢ç”Ÿï¼ˆå³æ™‚ï¼‰</button>
      <span class="small" style="margin-left:8px;">ï¼ˆforce=true ã§è»¢ç”Ÿæ¡ä»¶ã‚’ç„¡è¦–ã—ã¦è»¢ç”Ÿã‚’å®Ÿè¡Œï¼‰</span>
    </div>
    <div style="margin-top:8px;" class="small">ã¾ãŸã¯ URL ã« <code>?forcePrestige=1</code> ã‚’ä»˜ã‘ã¦èª­ã¿è¾¼ã‚€ã¨å³æ™‚è»¢ç”ŸãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</div>
  </div>

<script>
  // ---------- game state ----------
  let money = 0;
  let incomePerSecond = 1;
  let efficiency = 1;
  let prestigePoints = 0;
  let prestigeMultiplier = 1;
  let prestigeEffReduction = 1;
  let upgrades = [
    { name:"åå…¥ã‚¢ãƒƒãƒ—", desc:"åŸºæœ¬åå…¥ã‚’å°‘ã—ä¸Šã’ã¾ã™", baseCost:10, level:0, power:1.2 },
    { name:"åŠ¹ç‡ã‚¢ãƒƒãƒ—", desc:"åå…¥å€ç‡ã‚’å¼·åŒ–", baseCost:50, level:0, power:1.1 },
    { name:"è‡ªå‹•è²©å£²æ©Ÿ", desc:"å®šæœŸåå…¥ã‚’å¢—ã‚„ã™", baseCost:200, level:0, power:1.3 },
    { name:"éŠ€è¡ŒæŠ•è³‡", desc:"åŠ¹ç‡ã‚’å‘ä¸Š", baseCost:1000, level:0, power:1.25 },
    { name:"AIç”Ÿæˆå·¥å ´", desc:"è«å¤§ãªåå…¥ã‚’å¾—ã‚‹", baseCost:5000, level:0, power:1.4 },
  ];

  // ---------- helpers ----------
  function formatNum(num) {
    if (typeof num !== 'number') return String(num);
    if (!isFinite(num)) return "Infinity";
    if (num >= 1e9) return num.toExponential(2);
    return Math.floor(num).toLocaleString();
  }

  function getUpgradeCost(u) {
    return Math.floor(u.baseCost * Math.pow(2.2, u.level) / prestigeEffReduction);
  }

  // ---------- purchases ----------
  function buyUpgrade(i) {
    const u = upgrades[i];
    const cost = getUpgradeCost(u);
    if (money >= cost) {
      money -= cost;
      u.level++;
      // ãƒãƒ©ãƒ³ã‚¹èª¿æ•´æ¸ˆã¿ï¼ˆæ§ãˆã‚ã«ï¼‰
      incomePerSecond *= u.power;
      efficiency *= (1 + (u.power - 1) / 10);
      updateDisplay();
      saveGame();
    } else {
      alert("ãŠé‡‘ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚");
    }
  }

  function buyPrestigeUpgrade(type) {
    if (type === "mult" && prestigePoints >= 1) {
      prestigePoints -= 1;
      prestigeMultiplier += 1;
    } else if (type === "eff" && prestigePoints >= 2) {
      prestigePoints -= 2;
      prestigeEffReduction += 0.2;
    } else {
      alert("è»¢ç”Ÿãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ã€‚");
      return;
    }
    updateDisplay();
    saveGame();
  }

  // ---------- prestige (è»¢ç”Ÿ) ----------
  // force=true ã®ã¨ãã¯ money æ¡ä»¶ã‚’ç„¡è¦–ã—ã¦å¼·åˆ¶è»¢ç”Ÿï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
  function doPrestige(force = false) {
    // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã§ç„¡åŠ¹åŒ–ã§ãã‚‹ï¼‰
    const noConfirm = document.getElementById("dbgBypassConfirm")?.checked;
    if (!noConfirm && !force) {
      if (!confirm("æœ¬å½“ã«è»¢ç”Ÿã—ã¾ã™ã‹ï¼Ÿï¼ˆæ‰€æŒé‡‘ãƒ»ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ï¼‰")) return;
    }
    if (!force && (money < 1.8e308)) {
      alert("è»¢ç”Ÿæ¡ä»¶ã«é”ã—ã¦ã„ã¾ã›ã‚“ã€‚ï¼ˆé€šå¸¸ã¯ 1.8e308ï¼‰");
      return;
    }

    // é€šå¸¸ã¯1ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã©ãŠã‚Šï¼‰
    prestigePoints += 1;
    // ãƒªã‚»ãƒƒãƒˆ
    money = 0;
    incomePerSecond = 1;
    efficiency = 1;
    upgrades.forEach(u => u.level = 0);
    updateDisplay();
    saveGame();
    if (force) alert("å¼·åˆ¶è»¢ç”Ÿã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼ˆãƒ‡ãƒãƒƒã‚°ï¼‰ã€‚è»¢ç”Ÿãƒã‚¤ãƒ³ãƒˆ +1");
    else alert("ğŸŒŒ å®‡å®™ã®é™ç•Œã‚’è¶…ãˆãŸï¼ è»¢ç”Ÿãƒã‚¤ãƒ³ãƒˆ +1");
  }

  // ---------- save/load ----------
  function saveGame() {
    try {
      const save = { money, incomePerSecond, efficiency, prestigePoints, prestigeMultiplier, prestigeEffReduction, upgrades };
      localStorage.setItem("idleInfinitySave_debug", JSON.stringify(save));
    } catch (e) { console.warn("save failed", e); }
  }

  function loadGame() {
    try {
      const data = JSON.parse(localStorage.getItem("idleInfinitySave_debug") || "{}");
      // å®‰å…¨ã«å‰²ã‚Šå½“ã¦ï¼ˆå­˜åœ¨ã™ã‚‹ã‚‚ã®ã ã‘ï¼‰
      if (typeof data.money === 'number') money = data.money;
      if (typeof data.incomePerSecond === 'number') incomePerSecond = data.incomePerSecond;
      if (typeof data.efficiency === 'number') efficiency = data.efficiency;
      if (typeof data.prestigePoints === 'number') prestigePoints = data.prestigePoints;
      if (typeof data.prestigeMultiplier === 'number') prestigeMultiplier = data.prestigeMultiplier;
      if (typeof data.prestigeEffReduction === 'number') prestigeEffReduction = data.prestigeEffReduction;
      if (Array.isArray(data.upgrades) && data.upgrades.length === upgrades.length) {
        upgrades = data.upgrades;
      }
    } catch(e){ console.warn("load failed", e); }
  }

  // ---------- UI ----------
  function updateDisplay() {
    const totalRate = incomePerSecond * efficiency * prestigeMultiplier;
    document.getElementById("money").textContent = formatNum(money);
    document.getElementById("rate").textContent = formatNum(totalRate);
    document.getElementById("prestigePoints").textContent = prestigePoints;
    document.getElementById("prestigeMultLevel").textContent = prestigeMultiplier - 1;
    document.getElementById("prestigeEffLevel").textContent = (prestigeEffReduction - 1).toFixed(1);

    // upgrade list
    const list = document.getElementById("upgradeList");
    list.innerHTML = "";
    upgrades.forEach((u, i) => {
      const div = document.createElement("div");
      div.className = "upgrade-card";
      div.innerHTML = `
        <h3>${u.name}</h3>
        <p>${u.desc}</p>
        <p>Lv ${u.level}</p>
        <button onclick="buyUpgrade(${i})">è³¼å…¥ï¼ˆ${formatNum(getUpgradeCost(u))}ï¼‰</button>
      `;
      list.appendChild(div);
    });

    // prestige button (é€šå¸¸ã¯è¶…ã‚¤ãƒ³ãƒ•ãƒ¬æ¡ä»¶)
    document.getElementById("prestigeBtn").disabled = !(money >= 1.8e308);

    // meter: 0..100% per 1000 currency (arbitrary visual)
    const fill = document.getElementById("fill");
    let percent = 0;
    if (isFinite(money)) {
      percent = Math.min((money % 1000) / 1000 * 100, 100);
    } else {
      percent = 100;
    }
    fill.style.width = percent + "%";
  }

  // ---------- DEBUG helpers ----------
  function dbgSetMoney() {
    const v = document.getElementById("dbgMoney").value.trim();
    if (!v) { alert("å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
    // allow scientific notation like "1.8e308"
    const num = Number(v);
    if (!isFinite(num) && v.toLowerCase().includes("e")) {
      // try parsing big exponent via parseFloat (Number already)
    }
    money = num;
    updateDisplay();
    saveGame();
  }
  function dbgSetPrestige() {
    const v = document.getElementById("dbgPrestige").value.trim();
    const n = parseInt(v) || 0;
    prestigePoints = n;
    updateDisplay();
    saveGame();
  }
  function dbgForcePrestige() {
    if (!document.getElementById("dbgBypassConfirm").checked) {
      if (!confirm("å¼·åˆ¶è»¢ç”Ÿã—ã¾ã™ã‹ï¼Ÿï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ»å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰")) return;
    }
    doPrestige(true);
  }

  // ---------- main loop ----------
  loadGame();

  // check URL params for debug
  const params = new URLSearchParams(location.search);
  if (params.get("money")) {
    const m = Number(params.get("money"));
    if (isFinite(m)) { money = m; }
    else if (params.get("money").toLowerCase().includes("e")) money = Number(params.get("money"));
  }
  // if forcePrestige param present, do immediate forced prestige
  if (params.get("forcePrestige") === "1" || params.get("forcePrestige") === "true") {
    // small timeout so UI loads then run
    setTimeout(() => { doPrestige(true); }, 200);
  }

  let last = Date.now();
  function loop() {
    const now = Date.now();
    const delta = (now - last) / 1000;
    last = now;
    money += incomePerSecond * efficiency * prestigeMultiplier * delta;
    updateDisplay();
    requestAnimationFrame(loop);
  }
  updateDisplay();
  loop();
</script>
</body>
</html>
